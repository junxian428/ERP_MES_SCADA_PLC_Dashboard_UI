{"ast":null,"code":"'use strict';\n\nrequire(\"core-js/modules/es.array.push.js\");\nvar _ = require('lodash');\nvar groupPartitionsByTopic = require('../utils').groupPartitionsByTopic;\nvar logger = require('../logging')('kafka-node:Roundrobin');\nvar VERSION = 0;\nfunction assignRoundRobin(topicPartition, groupMembers, callback) {\n  logger.debug('topicPartition: %j', topicPartition);\n  logger.debug('groupMembers: %j', groupMembers);\n  var _members = _(groupMembers).map('id');\n  var members = _members.value().sort();\n  logger.debug('members', members);\n  var assignment = _members.reduce(function (obj, id) {\n    obj[id] = [];\n    return obj;\n  }, {});\n  var subscriberMap = groupMembers.reduce(function (subscribers, member) {\n    subscribers[member.id] = member.subscription;\n    return subscribers;\n  }, {});\n  logger.debug('subscribers', subscriberMap);\n\n  // layout topic/partitions pairs into a list\n  var topicPartitionList = _(topicPartition).map(function (partitions, topic) {\n    return partitions.map(function (partition) {\n      return {\n        topic: topic,\n        partition: partition\n      };\n    });\n  }).flatten().value();\n  logger.debug('round robin on topic partition pairs: ', topicPartitionList);\n  var assigner = cycle(members);\n  topicPartitionList.forEach(function (tp) {\n    var topic = tp.topic;\n    while (!_.includes(subscriberMap[assigner.peek()], topic)) {\n      assigner.next();\n    }\n    assignment[assigner.next()].push(tp);\n  });\n  var ret = _.map(assignment, function (value, key) {\n    var ret = {};\n    ret.memberId = key;\n    ret.topicPartitions = groupPartitionsByTopic(value);\n    ret.version = VERSION;\n    return ret;\n  });\n  callback(null, ret);\n}\nfunction cycle(arr) {\n  var index = -1;\n  var len = arr.length;\n  return {\n    peek: function () {\n      return arr[(index + 1) % len];\n    },\n    next: function () {\n      index = ++index % len;\n      return arr[index];\n    }\n  };\n}\nmodule.exports = {\n  assign: assignRoundRobin,\n  name: 'roundrobin',\n  version: VERSION\n};","map":{"version":3,"names":["require","_","groupPartitionsByTopic","logger","VERSION","assignRoundRobin","topicPartition","groupMembers","callback","debug","_members","map","members","value","sort","assignment","reduce","obj","id","subscriberMap","subscribers","member","subscription","topicPartitionList","partitions","topic","partition","flatten","assigner","cycle","forEach","tp","includes","peek","next","push","ret","key","memberId","topicPartitions","version","arr","index","len","length","module","exports","assign","name"],"sources":["D:/Project/VUEJSSPRING_CRUD_JWT/vue-crud-api-jwt-vuex/node_modules/kafka-node/lib/assignment/roundrobin.js"],"sourcesContent":["'use strict';\n\nvar _ = require('lodash');\nvar groupPartitionsByTopic = require('../utils').groupPartitionsByTopic;\nvar logger = require('../logging')('kafka-node:Roundrobin');\nvar VERSION = 0;\n\nfunction assignRoundRobin (topicPartition, groupMembers, callback) {\n  logger.debug('topicPartition: %j', topicPartition);\n  logger.debug('groupMembers: %j', groupMembers);\n  var _members = _(groupMembers).map('id');\n  var members = _members.value().sort();\n  logger.debug('members', members);\n  var assignment = _members.reduce(function (obj, id) {\n    obj[id] = [];\n    return obj;\n  }, {});\n\n  var subscriberMap = groupMembers.reduce(function (subscribers, member) {\n    subscribers[member.id] = member.subscription;\n    return subscribers;\n  }, {});\n\n  logger.debug('subscribers', subscriberMap);\n\n  // layout topic/partitions pairs into a list\n  var topicPartitionList = _(topicPartition).map(function (partitions, topic) {\n    return partitions.map(function (partition) {\n      return {\n        topic: topic,\n        partition: partition\n      };\n    });\n  }).flatten().value();\n  logger.debug('round robin on topic partition pairs: ', topicPartitionList);\n\n  var assigner = cycle(members);\n\n  topicPartitionList.forEach(function (tp) {\n    var topic = tp.topic;\n    while (!_.includes(subscriberMap[assigner.peek()], topic)) {\n      assigner.next();\n    }\n    assignment[assigner.next()].push(tp);\n  });\n\n  var ret = _.map(assignment, function (value, key) {\n    var ret = {};\n    ret.memberId = key;\n    ret.topicPartitions = groupPartitionsByTopic(value);\n    ret.version = VERSION;\n    return ret;\n  });\n\n  callback(null, ret);\n}\n\nfunction cycle (arr) {\n  var index = -1;\n  var len = arr.length;\n  return {\n    peek: function () {\n      return arr[(index + 1) % len];\n    },\n    next: function () {\n      index = ++index % len;\n      return arr[index];\n    }\n  };\n}\n\nmodule.exports = {\n  assign: assignRoundRobin,\n  name: 'roundrobin',\n  version: VERSION\n};\n"],"mappings":"AAAA,YAAY;;AAACA,OAAA;AAEb,IAAIC,CAAC,GAAGD,OAAO,CAAC,QAAQ,CAAC;AACzB,IAAIE,sBAAsB,GAAGF,OAAO,CAAC,UAAU,CAAC,CAACE,sBAAsB;AACvE,IAAIC,MAAM,GAAGH,OAAO,CAAC,YAAY,CAAC,CAAC,uBAAuB,CAAC;AAC3D,IAAII,OAAO,GAAG,CAAC;AAEf,SAASC,gBAAgBA,CAAEC,cAAc,EAAEC,YAAY,EAAEC,QAAQ,EAAE;EACjEL,MAAM,CAACM,KAAK,CAAC,oBAAoB,EAAEH,cAAc,CAAC;EAClDH,MAAM,CAACM,KAAK,CAAC,kBAAkB,EAAEF,YAAY,CAAC;EAC9C,IAAIG,QAAQ,GAAGT,CAAC,CAACM,YAAY,CAAC,CAACI,GAAG,CAAC,IAAI,CAAC;EACxC,IAAIC,OAAO,GAAGF,QAAQ,CAACG,KAAK,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC;EACrCX,MAAM,CAACM,KAAK,CAAC,SAAS,EAAEG,OAAO,CAAC;EAChC,IAAIG,UAAU,GAAGL,QAAQ,CAACM,MAAM,CAAC,UAAUC,GAAG,EAAEC,EAAE,EAAE;IAClDD,GAAG,CAACC,EAAE,CAAC,GAAG,EAAE;IACZ,OAAOD,GAAG;EACZ,CAAC,EAAE,CAAC,CAAC,CAAC;EAEN,IAAIE,aAAa,GAAGZ,YAAY,CAACS,MAAM,CAAC,UAAUI,WAAW,EAAEC,MAAM,EAAE;IACrED,WAAW,CAACC,MAAM,CAACH,EAAE,CAAC,GAAGG,MAAM,CAACC,YAAY;IAC5C,OAAOF,WAAW;EACpB,CAAC,EAAE,CAAC,CAAC,CAAC;EAENjB,MAAM,CAACM,KAAK,CAAC,aAAa,EAAEU,aAAa,CAAC;;EAE1C;EACA,IAAII,kBAAkB,GAAGtB,CAAC,CAACK,cAAc,CAAC,CAACK,GAAG,CAAC,UAAUa,UAAU,EAAEC,KAAK,EAAE;IAC1E,OAAOD,UAAU,CAACb,GAAG,CAAC,UAAUe,SAAS,EAAE;MACzC,OAAO;QACLD,KAAK,EAAEA,KAAK;QACZC,SAAS,EAAEA;MACb,CAAC;IACH,CAAC,CAAC;EACJ,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAACd,KAAK,CAAC,CAAC;EACpBV,MAAM,CAACM,KAAK,CAAC,wCAAwC,EAAEc,kBAAkB,CAAC;EAE1E,IAAIK,QAAQ,GAAGC,KAAK,CAACjB,OAAO,CAAC;EAE7BW,kBAAkB,CAACO,OAAO,CAAC,UAAUC,EAAE,EAAE;IACvC,IAAIN,KAAK,GAAGM,EAAE,CAACN,KAAK;IACpB,OAAO,CAACxB,CAAC,CAAC+B,QAAQ,CAACb,aAAa,CAACS,QAAQ,CAACK,IAAI,CAAC,CAAC,CAAC,EAAER,KAAK,CAAC,EAAE;MACzDG,QAAQ,CAACM,IAAI,CAAC,CAAC;IACjB;IACAnB,UAAU,CAACa,QAAQ,CAACM,IAAI,CAAC,CAAC,CAAC,CAACC,IAAI,CAACJ,EAAE,CAAC;EACtC,CAAC,CAAC;EAEF,IAAIK,GAAG,GAAGnC,CAAC,CAACU,GAAG,CAACI,UAAU,EAAE,UAAUF,KAAK,EAAEwB,GAAG,EAAE;IAChD,IAAID,GAAG,GAAG,CAAC,CAAC;IACZA,GAAG,CAACE,QAAQ,GAAGD,GAAG;IAClBD,GAAG,CAACG,eAAe,GAAGrC,sBAAsB,CAACW,KAAK,CAAC;IACnDuB,GAAG,CAACI,OAAO,GAAGpC,OAAO;IACrB,OAAOgC,GAAG;EACZ,CAAC,CAAC;EAEF5B,QAAQ,CAAC,IAAI,EAAE4B,GAAG,CAAC;AACrB;AAEA,SAASP,KAAKA,CAAEY,GAAG,EAAE;EACnB,IAAIC,KAAK,GAAG,CAAC,CAAC;EACd,IAAIC,GAAG,GAAGF,GAAG,CAACG,MAAM;EACpB,OAAO;IACLX,IAAI,EAAE,SAAAA,CAAA,EAAY;MAChB,OAAOQ,GAAG,CAAC,CAACC,KAAK,GAAG,CAAC,IAAIC,GAAG,CAAC;IAC/B,CAAC;IACDT,IAAI,EAAE,SAAAA,CAAA,EAAY;MAChBQ,KAAK,GAAG,EAAEA,KAAK,GAAGC,GAAG;MACrB,OAAOF,GAAG,CAACC,KAAK,CAAC;IACnB;EACF,CAAC;AACH;AAEAG,MAAM,CAACC,OAAO,GAAG;EACfC,MAAM,EAAE1C,gBAAgB;EACxB2C,IAAI,EAAE,YAAY;EAClBR,OAAO,EAAEpC;AACX,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}